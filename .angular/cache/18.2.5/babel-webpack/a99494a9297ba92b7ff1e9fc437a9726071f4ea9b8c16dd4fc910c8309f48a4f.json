{"ast":null,"code":"import { FormsModule } from '@angular/forms';\nimport { HttpClientModule } from '@angular/common/http';\nimport { CommonModule } from '@angular/common';\nimport * as L from 'leaflet';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./dunkin.service\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"@angular/common\";\nconst _c0 = [\"cheapestDisplay\"];\nconst _c1 = (a0, a1) => ({\n  \"fa-chevron-right\": a0,\n  \"fa-chevron-down\": a1\n});\nfunction AppComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\");\n  }\n}\nfunction AppComponent_ng_template_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵelement(1, \"span\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"p\");\n    i0.ɵɵtext(3, \"Fetching Location\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_div_14_p_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"Fetching Menus from nearby Dunkin\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_div_14_ng_template_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"Processing Menu\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"div\", 16);\n    i0.ɵɵelement(2, \"span\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, AppComponent_div_14_p_3_Template, 2, 0, \"p\", 5)(4, AppComponent_div_14_ng_template_4_Template, 2, 0, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const processingMenuLoadingMessage_r2 = i0.ɵɵreference(5);\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.fetchingMenu)(\"ngIfElse\", processingMenuLoadingMessage_r2);\n  }\n}\nfunction AppComponent_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r2.errorMessage);\n  }\n}\nfunction AppComponent_h2_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"Cheapest Location for a \", ctx_r2.selectedItem, \":\");\n  }\n}\nfunction AppComponent_div_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r2.cheapestLocation.address.line1, \" - $\", ctx_r2.cheapestPrice, \"\");\n  }\n}\nfunction AppComponent_div_20_div_4_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_20_div_4_div_1_Template_div_click_0_listener() {\n      const item_r7 = i0.ɵɵrestoreView(_r6).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r2.selectItem(item_r7));\n    });\n    i0.ɵɵelementStart(1, \"span\", 26);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const item_r7 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r7.name);\n  }\n}\nfunction AppComponent_div_20_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 23);\n    i0.ɵɵtemplate(1, AppComponent_div_20_div_4_div_1_Template, 3, 1, \"div\", 24);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const category_r5 = i0.ɵɵnextContext().$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.categoryMenuItems[category_r5]);\n  }\n}\nfunction AppComponent_div_20_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"h3\", 20);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_20_Template_h3_click_1_listener() {\n      const category_r5 = i0.ɵɵrestoreView(_r4).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.toggleCategory(category_r5));\n    });\n    i0.ɵɵelement(2, \"i\", 21);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, AppComponent_div_20_div_4_Template, 2, 1, \"div\", 22);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const category_r5 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(3, _c1, !ctx_r2.isCategoryVisible(category_r5), ctx_r2.isCategoryVisible(category_r5)));\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", category_r5, \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.isCategoryVisible(category_r5));\n  }\n}\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor(dunkinService) {\n      this.dunkinService = dunkinService;\n      this.lat = 0;\n      this.long = 0;\n      this.dist = 1.5;\n      this.menuItems = [];\n      this.storeList = [];\n      this.cheapestPrice = Infinity;\n      this.selectedItem = null;\n      this.errorMessage = null;\n      this.cheapestLocation = null;\n      this.fetchingLocation = false;\n      this.fetchingMenu = false;\n      this.processingMenu = false;\n      this.findingCheapest = false;\n      this.imagePath = 'assets/leaflet/';\n      this.circle = null;\n      this.categoryMenuItems = {};\n      this.categoryVisibility = {};\n    }\n    ngOnInit() {\n      this.getCurrentLocation();\n    }\n    generateCircle() {\n      if (this.circle) {\n        this.map.removeLayer(this.circle);\n      }\n      if (this.map) {\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n          attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(this.map);\n        // Set default options for Leaflet icons\n        L.Icon.Default.mergeOptions({\n          iconUrl: 'assets/leaflet/marker-icon.png',\n          iconRetinaUrl: 'assets/leaflet/marker-icon-2x.png',\n          shadowUrl: 'assets/leaflet/marker-shadow.png'\n        });\n        // Add a radius circle based on user input\n        this.circle = L.circle([this.lat, this.long], {\n          color: 'red',\n          fillColor: '#f03',\n          fillOpacity: 0.5,\n          radius: this.dist * 1609.34 // conversion from miles to meters\n        }).addTo(this.map);\n      }\n    }\n    getCurrentLocation() {\n      this.fetchingLocation = true;\n      if (navigator.geolocation) {\n        navigator.geolocation.getCurrentPosition(position => {\n          this.lat = position.coords.latitude;\n          this.long = position.coords.longitude;\n          this.fetchingLocation = false;\n          // Initialize the map after getting the location\n          this.map = L.map('map', {\n            center: [this.lat, this.long],\n            zoom: 13\n          });\n          // Generate the map once it's initialized\n          this.generateCircle();\n        }, error => {\n          this.errorMessage = 'Unable to retrieve location. Please enter manually.';\n          this.fetchingLocation = false;\n        });\n      } else {\n        console.log('Geolocation is not supported by this browser.');\n        this.errorMessage = 'Geolocation is not supported by this browser.';\n        this.fetchingLocation = false;\n      }\n    }\n    fetchMenuItems() {\n      if (this.lat !== null && this.long !== null) {\n        this.fetchingMenu = true;\n        this.dunkinService.getMenuItems(this.lat, this.long, this.dist).subscribe({\n          next: data => {\n            console.log('processing menu');\n            this.fetchingMenu = false;\n            this.processingMenu = true;\n            this.storeList = data;\n            this.storeList.forEach(storeDict => {\n              if (Array.isArray(storeDict.menu)) {\n                console.log(storeDict);\n                storeDict['menu'].forEach(menuItem => {\n                  if (!this.menuItems.includes(menuItem.name)) {\n                    console.log('pushing ' + menuItem.name);\n                    this.menuItems.push(menuItem.name);\n                    const category = menuItem.category || 'Other'; // Use 'Other' for items with no category\n                    if (!this.categoryMenuItems[category]) {\n                      this.categoryMenuItems[category] = [];\n                    }\n                    console.log(menuItem);\n                    this.categoryMenuItems[category].push(menuItem);\n                  }\n                });\n              }\n            });\n            this.processingMenu = false;\n            console.log(this.categoryMenuItems);\n          },\n          error: error => {\n            this.errorMessage = 'Failed to load menu items';\n            this.fetchingMenu = false;\n          }\n        });\n      } else {\n        this.errorMessage = 'Please provide valid latitude and longitude.';\n      }\n    }\n    onItemSelect() {\n      if (this.selectedItem) {\n        this.findingCheapest = true;\n        this.cheapestPrice = Infinity;\n        this.storeList.forEach(store => {\n          if (Array.isArray(store.menu) && store.menu != null) {\n            const foundItem = store.menu.find(item => item.name === this.selectedItem);\n            if (foundItem && foundItem.price < this.cheapestPrice) {\n              this.cheapestLocation = store.store;\n              this.cheapestPrice = foundItem.price;\n            }\n          }\n        });\n        this.findingCheapest = false;\n        this.scrollToCheapestDisplay();\n      }\n    }\n    toggleCategory(category) {\n      this.categoryVisibility[category] = !this.categoryVisibility[category];\n    }\n    isCategoryVisible(category) {\n      return this.categoryVisibility[category];\n    }\n    getCategoryKeys() {\n      return Object.keys(this.categoryMenuItems);\n    }\n    selectItem(item) {\n      console.log('selected item');\n      this.selectedItem = item.name;\n      this.onItemSelect();\n    }\n    scrollToCheapestDisplay() {\n      if (this.cheapestDisplay) {\n        const elementPosition = this.cheapestDisplay.nativeElement.getBoundingClientRect().top + window.scrollY;\n        const windowHeight = window.innerHeight;\n        const targetPosition = elementPosition - windowHeight;\n        window.scrollTo({\n          top: targetPosition,\n          behavior: 'smooth'\n        });\n      }\n    }\n    static {\n      this.ɵfac = function AppComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || AppComponent)(i0.ɵɵdirectiveInject(i1.DunkinService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AppComponent,\n        selectors: [[\"app-root\"]],\n        viewQuery: function AppComponent_Query(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵviewQuery(_c0, 5);\n          }\n          if (rf & 2) {\n            let _t;\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.cheapestDisplay = _t.first);\n          }\n        },\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 21,\n        vars: 9,\n        consts: [[\"loading_location\", \"\"], [\"cheapestDisplay\", \"\"], [\"processingMenuLoadingMessage\", \"\"], [1, \"container\", 2, \"text-align\", \"center\"], [3, \"submit\"], [4, \"ngIf\", \"ngIfElse\"], [\"id\", \"map\", 2, \"height\", \"400px\"], [1, \"form-group\"], [\"for\", \"dist\"], [\"type\", \"number\", \"step\", \"any\", \"name\", \"dist\", \"required\", \"\", 1, \"form-control\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [\"type\", \"submit\", 1, \"mt-3\", \"btn\", \"btn-primary\", 3, \"disabled\"], [\"class\", \"mt-3\", 4, \"ngIf\"], [\"style\", \"color: red\", 4, \"ngIf\"], [\"id\", \"cheapest-display\", 1, \"mt-2\"], [4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [\"role\", \"status\", 1, \"spinner-border\"], [1, \"sr-only\"], [1, \"mt-3\"], [2, \"color\", \"red\"], [1, \"mt-2\", \"category-header\", 3, \"click\"], [1, \"fas\", 3, \"ngClass\"], [\"class\", \"category-content\", 4, \"ngIf\"], [1, \"category-content\"], [\"class\", \"menu-item\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"menu-item\", 3, \"click\"], [1, \"item-name\"]],\n        template: function AppComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"div\", 3)(1, \"h1\");\n            i0.ɵɵtext(2, \"Dunkin' Donuts Menu Items Finder\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"form\", 4);\n            i0.ɵɵlistener(\"submit\", function AppComponent_Template_form_submit_3_listener($event) {\n              i0.ɵɵrestoreView(_r1);\n              ctx.fetchMenuItems();\n              return i0.ɵɵresetView($event.preventDefault());\n            });\n            i0.ɵɵtemplate(4, AppComponent_div_4_Template, 1, 0, \"div\", 5)(5, AppComponent_ng_template_5_Template, 4, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n            i0.ɵɵelement(7, \"div\", 6);\n            i0.ɵɵelementStart(8, \"div\", 7)(9, \"label\", 8);\n            i0.ɵɵtext(10, \"Distance (miles):\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(11, \"input\", 9);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AppComponent_Template_input_ngModelChange_11_listener($event) {\n              i0.ɵɵrestoreView(_r1);\n              i0.ɵɵtwoWayBindingSet(ctx.dist, $event) || (ctx.dist = $event);\n              return i0.ɵɵresetView($event);\n            });\n            i0.ɵɵlistener(\"change\", function AppComponent_Template_input_change_11_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.generateCircle());\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(12, \"button\", 10);\n            i0.ɵɵtext(13, \" Find Menu Items \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(14, AppComponent_div_14_Template, 6, 2, \"div\", 11)(15, AppComponent_div_15_Template, 2, 1, \"div\", 12);\n            i0.ɵɵelementStart(16, \"div\", 13, 1);\n            i0.ɵɵtemplate(18, AppComponent_h2_18_Template, 2, 1, \"h2\", 14)(19, AppComponent_div_19_Template, 3, 2, \"div\", 14);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(20, AppComponent_div_20_Template, 5, 6, \"div\", 15);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            const loading_location_r8 = i0.ɵɵreference(6);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"ngIf\", !ctx.fetchingLocation)(\"ngIfElse\", loading_location_r8);\n            i0.ɵɵadvance(7);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.dist);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"disabled\", ctx.fetchingMenu || ctx.processingMenu || ctx.lat === null || ctx.long === null);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.fetchingMenu || ctx.processingMenu);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.errorMessage);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", ctx.cheapestLocation);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.cheapestLocation);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngForOf\", ctx.getCategoryKeys());\n          }\n        },\n        dependencies: [FormsModule, i2.ɵNgNoValidate, i2.DefaultValueAccessor, i2.NumberValueAccessor, i2.NgControlStatus, i2.NgControlStatusGroup, i2.RequiredValidator, i2.NgModel, i2.NgForm, HttpClientModule, CommonModule, i3.NgClass, i3.NgForOf, i3.NgIf],\n        styles: [\".category-header[_ngcontent-%COMP%]{display:flex;align-items:center;background-color:#e0f7fa;padding:10px;cursor:pointer}.category-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:10px}.category-header[_ngcontent-%COMP%]:hover{background-color:#b2ebf2}.category-content[_ngcontent-%COMP%]{padding:10px 20px;background-color:#f0f9ff;border-left:4px solid #007bff}.menu-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #ddd;cursor:pointer}.menu-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.item-name[_ngcontent-%COMP%]{font-weight:700;color:#333}\"]\n      });\n    }\n  }\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}